#!/bin/bash
# .fresher/hooks/next_iteration
# Runs before each iteration

echo "Starting iteration ${FRESHER_ITERATION:-1}"

if [[ ${FRESHER_ITERATION:-1} -gt 1 ]]; then
  echo "Previous iteration: exit=${FRESHER_LAST_EXIT_CODE:-0}, duration=${FRESHER_LAST_DURATION:-0}s"
  echo "Commits so far: ${FRESHER_COMMITS_MADE:-0}"
fi

# Example: Skip if no changes needed (building mode only)
# if [[ "$FRESHER_MODE" == "building" ]]; then
#   pending=$(grep -c '^\s*-\s*\[\s\]' IMPLEMENTATION_PLAN.md 2>/dev/null || echo "0")
#   if [[ "$pending" -eq 0 ]]; then
#     echo "No pending tasks, skipping iteration"
#     exit 1  # Skip
#   fi
# fi

# Example: Desktop notification (macOS)
# terminal-notifier -title "Fresher" -message "Starting iteration $FRESHER_ITERATION" 2>/dev/null || true

# Example: Desktop notification (Linux)
# notify-send "Fresher" "Starting iteration $FRESHER_ITERATION" 2>/dev/null || true

exit 0
