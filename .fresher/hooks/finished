#!/bin/bash
# .fresher/hooks/finished
# Runs when the loop ends

echo ""
echo "════════════════════════════════════════"
echo "Fresher loop finished"
echo "════════════════════════════════════════"
echo "Finish type: ${FRESHER_FINISH_TYPE:-unknown}"
echo "Total iterations: ${FRESHER_TOTAL_ITERATIONS:-0}"
echo "Total commits: ${FRESHER_TOTAL_COMMITS:-0}"
echo "Duration: ${FRESHER_DURATION:-0}s"
echo "════════════════════════════════════════"

# Determine summary message
case "${FRESHER_FINISH_TYPE:-unknown}" in
  complete)
    message="All tasks completed successfully!"
    ;;
  manual)
    message="Loop stopped by user"
    ;;
  max_iterations)
    message="Reached max iterations limit"
    ;;
  no_changes)
    message="No changes made in last iteration"
    ;;
  error)
    message="Loop stopped due to error"
    ;;
  hook_abort)
    message="Loop aborted by hook"
    ;;
  *)
    message="Loop finished: ${FRESHER_FINISH_TYPE:-unknown}"
    ;;
esac

echo "$message"

# Example: Desktop notification (macOS)
# terminal-notifier -title "Fresher Complete" -message "$message" 2>/dev/null || true

# Example: Desktop notification (Linux)
# notify-send "Fresher Complete" "$message" 2>/dev/null || true

# Example: Slack/Discord webhook (uncomment to enable)
# curl -s -X POST "$SLACK_WEBHOOK" \
#   -H "Content-Type: application/json" \
#   -d "{\"text\": \"Fresher: $message\nIterations: $FRESHER_TOTAL_ITERATIONS\nCommits: $FRESHER_TOTAL_COMMITS\"}"

exit 0
